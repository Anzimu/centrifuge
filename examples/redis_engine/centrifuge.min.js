!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Centrifuge",[],t):"object"==typeof exports?exports.Centrifuge=t():e.Centrifuge=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(s){if(n[s])return n[s].exports;var i=n[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,s){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:s})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=31)}({10:function(e,t,n){"use strict";(function(e){function s(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.Centrifuge=void 0;var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),c=n(6),h=s(c),l=n(11),_=s(l),f=n(12),d=n(7);t.Centrifuge=function(t){function n(e,t){i(this,n);var s=r(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return s._url=e,s._promise=null,s._sockjs=null,s._isSockjs=!1,s._binary=!1,s._methodType=null,s._pushType=null,s._encoder=null,s._decoder=null,s._status="disconnected",s._reconnect=!0,s._reconnecting=!1,s._transport=null,s._transportName=null,s._transportClosed=!0,s._messageId=0,s._clientID=null,s._subs={},s._lastPubUID={},s._messages=[],s._isBatching=!1,s._isAuthBatching=!1,s._authChannels={},s._numRefreshFailed=0,s._refreshTimeout=null,s._pingInterval=null,s._pongTimeout=null,s._retries=0,s._callbacks={},s._latency=null,s._latencyStart=null,s._connectData=null,s._credentials=null,s._config={debug:!1,sockjs:null,promise:null,retry:1e3,maxRetry:2e4,timeout:5e3,resubscribe:!0,ping:!0,pingInterval:3e4,pongWaitTimeout:5e3,privateChannelPrefix:"$",onTransportClose:null,sockjsServer:null,sockjsTransports:["websocket","xdr-streaming","xhr-streaming","eventsource","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"],refreshEndpoint:"/centrifuge/refresh",refreshHeaders:{},refreshParams:{},refreshData:{},refreshAttempts:null,refreshInterval:3e3,onRefreshFailed:null,onRefresh:null,authEndpoint:"/centrifuge/auth",authHeaders:{},authParams:{},onAuth:null},s._configure(t),s}return o(n,t),a(n,[{key:"setCredentials",value:function(e){this._credentials=e}},{key:"setConnectData",value:function(e){this._connectData=e}},{key:"_ajax",value:function(t,n,s,i,r){var o=this,u="";o._debug("sending AJAX request to",t);var a=e.XMLHttpRequest?new e.XMLHttpRequest:new e.ActiveXObject("Microsoft.XMLHTTP");for(var c in n)n.hasOwnProperty(c)&&(u.length>0&&(u+="&"),u+=encodeURIComponent(c)+"="+encodeURIComponent(n[c]));u.length>0&&(u="?"+u),a.open("POST",t+u,!0),"withCredentials"in a&&(a.withCredentials=!0),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.setRequestHeader("Content-Type","application/json");for(var h in s)s.hasOwnProperty(h)&&a.setRequestHeader(h,s[h]);return a.onreadystatechange=function(){if(4===a.readyState)if(200===a.status){var e=void 0,t=!1;try{e=JSON.parse(a.responseText),t=!0}catch(e){r(!0,"JSON returned was invalid, yet status code was 200. Data was: "+a.responseText)}t&&r(!1,e)}else o._log("Couldn't get auth info from application",a.status),r(!0,a.status)},setTimeout(function(){a.send(JSON.stringify(i))},20),a}},{key:"_log",value:function(){(0,d.log)("info",arguments)}},{key:"_debug",value:function(){!0===this._config.debug&&(0,d.log)("debug",arguments)}},{key:"_websocketSupported",value:function(){return!("function"!=typeof WebSocket&&"object"!==("undefined"==typeof WebSocket?"undefined":u(WebSocket)))}},{key:"_setFormat",value:function(e){if(!this._formatOverride(e)){if("protobuf"===e)throw new Error("not implemented by JSON only Centrifuge client â€“ use client with Protobuf");this._binary=!1,this._methodType=f.JsonMethodType,this._pushType=f.JsonPushType,this._encoder=new f.JsonEncoder,this._decoder=new f.JsonDecoder}}},{key:"_formatOverride",value:function(e){return!1}},{key:"_configure",value:function(t){if(Object.assign(this._config,t||{}),this._debug("centrifuge config",this._config),!this._url)throw new Error("url required");if(null!==this._config.promise)this._promise=this._config.promise;else{if(!e.Promise)throw new Error("Promise polyfill required");this._promise=e.Promise}if((0,d.startsWith)(this._url,"ws")&&this._url.indexOf("format=protobuf")>-1?this._setFormat("protobuf"):this._setFormat("json"),(0,d.startsWith)(this._url,"http"))if(this._debug("client will try to connect to SockJS endpoint"),null!==this._config.sockjs)this._debug("SockJS explicitly provided in options"),this._sockjs=this._config.sockjs;else{if(void 0===e.SockJS)throw new Error("SockJS not found, use ws:// in url or include SockJS");this._debug("use globally defined SockJS"),this._sockjs=e.SockJS}else this._debug("client will connect to websocket endpoint")}},{key:"_setStatus",value:function(e){this._status!==e&&(this._debug("Status",this._status,"->",e),this._status=e)}},{key:"_isDisconnected",value:function(){return"disconnected"===this._status}},{key:"_isConnecting",value:function(){return"connecting"===this._status}},{key:"_isConnected",value:function(){return"connected"===this._status}},{key:"_nextMessageId",value:function(){return++this._messageId}},{key:"_resetRetry",value:function(){this._debug("reset retries count to 0"),this._retries=0}},{key:"_getRetryInterval",value:function(){var e=(0,d.backoff)(this._retries,this._config.retry,this._config.maxRetry);return this._retries+=1,e}},{key:"_clearConnectedState",value:function(e){this._clientID=null;for(var t in this._callbacks)if(this._callbacks.hasOwnProperty(t)){var n=this._callbacks[t],s=n.errback;if(!s)continue;s(this._createErrorObject("disconnected"))}this._callbacks={};for(var i in this._subs)if(this._subs.hasOwnProperty(i)){var r=this._subs[i];e?(r._isSuccess()&&r._triggerUnsubscribe(),r._setSubscribing()):r._setUnsubscribed()}this._config.resubscribe&&this._reconnect||(this._subs={})}},{key:"_transportSend",value:function(e){if(e.length){if(!this._transport)throw new Error("transport not connected");this._transport.send(this._encoder.encodeCommands(e))}}},{key:"_setupTransport",value:function(){var e=this;if(this._isSockjs=!1,null!==this._sockjs){var t={transports:this._config.sockjsTransports};null!==this._config.sockjsServer&&(t.server=this._config.sockjsServer),this._isSockjs=!0,this._transport=new this._sockjs(this._url,null,t)}else{if(!this._websocketSupported())return void this._debug("No Websocket support and no SockJS configured, can not connect");this._transport=new WebSocket(this._url),!0===this._binary&&(this._transport.binaryType="arraybuffer")}this._transport.onopen=function(){e._transportClosed=!1,e._reconnecting=!1,e._isSockjs?(e._transportName="sockjs-"+e._transport.transport,e._transport.onheartbeat=function(){e._restartPing()}):e._transportName="websocket",e._resetRetry();var t={};(e._credentials||e._connectData)&&(t.params={}),e._credentials&&(t.params.credentials=e._credentials),e._connectData&&(t.params.data=e._connectData),e._latencyStart=new Date,e._call(t).then(function(t){e._connectResponse(e._decoder.decodeCommandResult(e._methodType.CONNECT,t))},function(){e._disconnect("connect error",!0)})},this._transport.onerror=function(t){e._debug("transport level error",t)},this._transport.onclose=function(t){e._transportClosed=!0;var n="connection closed",s=!0;if(t&&"reason"in t&&t.reason)try{var i=JSON.parse(t.reason);e._debug("reason is an advice object",i),n=i.reason,s=i.reconnect}catch(i){n=t.reason,e._debug("reason is a plain string",n),s="disconnect"!==n}if(null!==e._config.onTransportClose&&e._config.onTransportClose({event:t,reason:n,reconnect:s}),e._disconnect(n,s),!0===e._reconnect){e._reconnecting=!0;var r=e._getRetryInterval();e._debug("reconnect after "+r+" milliseconds"),setTimeout(function(){!0===e._reconnect&&e._connect.call(e)},r)}},this._transport.onmessage=function(t){var n=e._decoder.decodeReplies(t.data);for(var s in n)n.hasOwnProperty(s)&&(e._debug("Received reply",n[s]),e._dispatchReply(n[s]));e._restartPing()}}},{key:"rpc",value:function(e){var t=this,n={method:t._methodType.RPC,params:{data:e}},s=this._call(n);return new t._promise(function(e,n){s.then(function(n){e(t._decoder.decodeCommandResult(t._methodType.RPC,n))},function(e){n(e)})})}},{key:"send",value:function(e){var t={method:this._methodType.SEND,params:{data:e}};return this._callAsync(t)}},{key:"_callAsync",value:function(e){this._addMessage(e,!0)}},{key:"_call",value:function(e){var t=this;return new t._promise(function(n,s){var i=t._addMessage(e);t._registerCall(i,n,s)})}},{key:"_connect",value:function(){if(this.isConnected())return void this._debug("connect called when already connected");"connecting"!==this._status&&(this._debug("start connecting"),this._setStatus("connecting"),this._clientID=null,this._reconnect=!0,this._setupTransport())}},{key:"_disconnect",value:function(e,t){if(!this._isDisconnected()){this._debug("disconnected:",e,t);var n=t||!1;!1===n&&(this._reconnect=!1),this._clearConnectedState(n),this._isDisconnected()||(this._setStatus("disconnected"),this._refreshTimeout&&clearTimeout(this._refreshTimeout),!1===this._reconnecting&&this.emit("disconnect",{reason:e,reconnect:n})),this._transportClosed||this._transport.close()}}},{key:"_refreshFailed",value:function(){this._numRefreshFailed=0,this._isDisconnected()||this._disconnect("refresh failed",!1),null!==this._config.onRefreshFailed&&this._config.onRefreshFailed()}},{key:"_refresh",value:function(){var e=this;if(this._debug("refresh credentials"),0===e._config.refreshAttempts)return this._debug("refresh attempts set to 0, do not send refresh request at all"),void e._refreshFailed();null!==e._refreshTimeout&&clearTimeout(e._refreshTimeout);var t=function(t,n){if(!0===t)return e._debug("error getting connection credentials from refresh endpoint",n),e._numRefreshFailed++,e._refreshTimeout&&clearTimeout(e._refreshTimeout),null!==e._config.refreshAttempts&&e._numRefreshFailed>=e._config.refreshAttempts?void e._refreshFailed():void(e._refreshTimeout=setTimeout(function(){e._refresh.call(e)},e._config.refreshInterval+Math.round(1e3*Math.random())));if(e._numRefreshFailed=0,null!==e._credentials)if(e._credentials.user=n.user,e._credentials.exp=n.exp,"info"in n&&(e._credentials.info=n.info),e._credentials.sign=n.sign,e._isDisconnected())e._debug("credentials refreshed, connect from scratch"),e._connect();else{e._debug("send refreshed credentials");var s={method:e._methodType.REFRESH,params:{credentials:e._credentials}};e._call(s).then(function(t){e._refreshResponse(e._decoder.decodeCommandResult(e._methodType.REFRESH,t))},function(){e._disconnect("refresh error",!0)})}};if(null!==this._config.onRefresh){var n={};this._config.onRefresh(n,t)}else this._ajax(this._config.refreshEndpoint,this._config.refreshParams,this._config.refreshHeaders,this._config.refreshData,t)}},{key:"_subscribe",value:function(e){var t=e.channel;if(t in this._subs||(this._subs[t]=e),!this.isConnected())return void e._setNew();e._setSubscribing();var n={method:this._methodType.SUBSCRIBE,params:{channel:t}};if((0,d.startsWith)(t,this._config.privateChannelPrefix))this._isAuthBatching?this._authChannels[t]=!0:(this.startAuthBatching(),this._subscribe(e),this.stopAuthBatching());else{!0===this._recover(t)&&(n.params.recover=!0,n.params.last=this._getLastID(t));var s=this;this._call(n).then(function(e){s._subscribeResponse(t,s._decoder.decodeCommandResult(s._methodType.SUBSCRIBE,e))},function(e){s._subscribeError(e)})}}},{key:"_unsubscribe",value:function(e){this.isConnected()&&this._addMessage({method:this._methodType.UNSUBSCRIBE,params:{channel:e.channel}})}},{key:"getSub",value:function(e){return this._getSub(e)}},{key:"_getSub",value:function(e){var t=this._subs[e];return t||null}},{key:"_connectResponse",value:function(e){if(!this.isConnected()){if(null!==this._latencyStart&&(this._latency=(new Date).getTime()-this._latencyStart.getTime(),this._latencyStart=null),e.expires){if(e.expired)return this._reconnecting=!0,this._disconnect("expired",!0),void this._refresh()}this._clientID=e.client,this._setStatus("connected"),this._refreshTimeout&&clearTimeout(this._refreshTimeout);var t=this;if(e.expires&&(this._refreshTimeout=setTimeout(function(){t._refresh.call(t)},1e3*e.ttl)),this._config.resubscribe){this.startBatching(),this.startAuthBatching();for(var n in this._subs)if(this._subs.hasOwnProperty(n)){var s=this._subs[n];s._shouldResubscribe()&&this._subscribe(s)}this.stopAuthBatching(),this.stopBatching(!0)}this._restartPing();var i={client:e.client,transport:this._transportName,latency:this._latency};e.data&&(i.data=e.data),this.emit("connect",i)}}},{key:"_stopPing",value:function(){null!==this._pongTimeout&&clearTimeout(this._pongTimeout),null!==this._pingInterval&&clearInterval(this._pingInterval)}},{key:"_startPing",value:function(){if(!(!0!==this._config.ping||this._config.pingInterval<=0)&&this.isConnected()){var e=this;this._pingInterval=setInterval(function(){if(!e.isConnected())return void e._stopPing();e.ping(),e._pongTimeout=setTimeout(function(){e._disconnect("no ping",!0)},e._config.pongWaitTimeout)},this._config.pingInterval)}}},{key:"_restartPing",value:function(){this._stopPing(),this._startPing()}},{key:"_subscribeError",value:function(e,t){var n=this._getSub(e);if(n&&n._isSubscribing())return 0===t.code&&"timeout"===t.message?void this._disconnect("timeout",!0):void n._setSubscribeError(t)}},{key:"_subscribeResponse",value:function(e,t){var n=this._getSub(e);if(n&&n._isSubscribing()){var s=t.publications;if(s&&s.length>0){s=s.reverse();for(var i in s)s.hasOwnProperty(i)&&this._handlePublication(e,s[i])}else"last"in t&&(this._lastPubUID[e]=t.last);var r=!1;"recovered"in t&&(r=t.recovered),n._setSubscribeSuccess(r)}}},{key:"_handleReply",value:function(e){var t=e.id,n=e.result;if(t in this._callbacks){var s=this._callbacks[t];if(delete this._callbacks[t],(0,d.errorExists)(e)){var i=s.errback;if(!i)return;i(e.error)}else{var r=s.callback;if(!r)return;r(n)}}}},{key:"_handleJoin",value:function(e,t){var n=this._getSub(e);n&&n.emit("join",t)}},{key:"_handleLeave",value:function(e,t){var n=this._getSub(e);n&&n.emit("leave",t)}},{key:"_handleUnsub",value:function(e){var t=this._getSub(e);t&&t.unsubscribe()}},{key:"_handlePublication",value:function(e,t){this._lastPubUID[e]=t.uid;var n=this._getSub(e);n&&n.emit("publication",t)}},{key:"_handleMessage",value:function(e){this.emit("message",e.data)}},{key:"_refreshResponse",value:function(e){if(this._refreshTimeout&&clearTimeout(this._refreshTimeout),e.expires){var t=this;if(e.expired)return void(t._refreshTimeout=setTimeout(function(){t._refresh.call(t)},t._config.refreshInterval+Math.round(1e3*Math.random())));this._clientID=e.client,t._refreshTimeout=setTimeout(function(){t._refresh.call(t)},1e3*e.ttl)}}},{key:"_handlePush",value:function(e){var t=this._decoder.decodePush(e),n=0;"type"in t&&(n=t.type);var s=t.channel;if(n===this._pushType.PUBLICATION){var i=this._decoder.decodePushData(this._pushType.PUBLICATION,t.data);this._handlePublication(s,i)}else if(n===this._pushType.MESSAGE){var r=this._decoder.decodePushData(this._pushType.MESSAGE,t.data);this._handleMessage(r)}else if(n===this._pushType.JOIN){var o=this._decoder.decodePushData(this._pushType.JOIN,t.data);this._handleJoin(s,o)}else if(n===this._pushType.LEAVE){var u=this._decoder.decodePushData(this._pushType.LEAVE,t.data);this._handleLeave(s,u)}else n===this._pushType.UNSUB&&this._handleUnsub(s)}},{key:"_dispatchReply",value:function(e){if(void 0===e||null===e)return void this._debug("dispatch: got undefined or null reply");var t=e.id;t&&t>0?this._handleReply(e):this._handlePush(e.result)}},{key:"_flush",value:function(){var e=this._messages.slice(0);this._messages=[],this._transportSend(e)}},{key:"_ping",value:function(){this._addMessage({method:this._methodType.PING})}},{key:"_recover",value:function(e){return e in this._lastPubUID}},{key:"_getLastID",value:function(e){var t=this._lastPubUID[e];return t?(this._debug("last uid found and sent for channel",e),t):(this._debug("no last uid found for channel",e),"")}},{key:"_createErrorObject",value:function(e,t){return{message:e,code:t||0}}},{key:"_registerCall",value:function(e,t,n){var s=this;this._callbacks[e]={callback:t,errback:n},setTimeout(function(){delete s._callbacks[e],(0,d.isFunction)(n)&&n(s._createErrorObject("timeout"))},this._config.timeout)}},{key:"_addMessage",value:function(e,t){var n=void 0;return t||(n=this._nextMessageId(),e.id=n),!0===this._isBatching?this._messages.push(e):this._transportSend([e]),t?0:n}},{key:"isConnected",value:function(){return this._isConnected()}},{key:"connect",value:function(){this._connect()}},{key:"disconnect",value:function(){this._disconnect("client",!1)}},{key:"ping",value:function(){return this._ping()}},{key:"startBatching",value:function(){this._isBatching=!0}},{key:"stopBatching",value:function(e){e=e||!1,this._isBatching=!1,!0===e&&this.flush()}},{key:"flush",value:function(){this._flush()}},{key:"startAuthBatching",value:function(){this._isAuthBatching=!0}},{key:"stopAuthBatching",value:function(){var e,t;this._isAuthBatching=!1;var n=this._authChannels;this._authChannels={};var s=[];for(t in n)if(n.hasOwnProperty(t)){var i=this._getSub(t);if(!i)continue;s.push(t)}if(0!==s.length){var r={client:this._clientID,channels:s},o=this,u=function(n,i){if(!0!==n){var r=!1;o._isBatching||(o.startBatching(),r=!0);for(e in s)if(s.hasOwnProperty(e)){t=s[e];var u=i[t];if(!u){o._subscribeResponse({error:"channel not found in authorization response",body:{channel:t}});continue}if(u.status&&200!==u.status)o._subscribeResponse({error:u.status,body:{channel:t}});else{var a={method:o._methodType.SUBSCRIBE,params:{channel:t,client:o._clientID,info:u.info,sign:u.sign}},c=o._recover(t);!0===c&&(a.params.recover=!0,a.params.last=o._getLastID(t)),o._call(a).then(function(e){o._subscribeResponse(t,o._decoder.decodeCommandResult(o._methodType.SUBSCRIBE,e))},function(e){o._subscribeError(t,e)})}}r&&o.stopBatching(!0)}else{o._debug("authorization request failed");for(e in s)s.hasOwnProperty(e)&&(t=s[e],o._subscribeResponse({error:"authorization request failed",body:{channel:t}}))}};null!==this._config.onAuth?this._config.onAuth({data:r},u):this._ajax(this._config.authEndpoint,this._config.authParams,this._config.authHeaders,r,u)}}},{key:"subscribe",value:function(e,t){if(arguments.length<1)throw new Error("Illegal arguments number: required 1, got "+arguments.length);if(!(0,d.isString)(e))throw new Error("Illegal argument type: channel must be a string");if(!this._config.resubscribe&&!this.isConnected())throw new Error("Can not only subscribe in connected state when resubscribe option is off");var n=this._getSub(e);if(null!==n)return n._setEvents(t),n._isUnsubscribed()&&n.subscribe(),n;var s=new _.default(this,e,t);return this._subs[e]=s,s.subscribe(),s}}]),n}(h.default)}).call(t,n(3))},11:function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),u=n(6),a=function(e){return e&&e.__esModule?e:{default:e}}(u),c=n(7),h=0,l=function(e){function t(e,n,r){s(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.channel=n,o._centrifuge=e,o._status=h,o._error=null,o._isResubscribe=!1,o._recovered=!1,o._ready=!1,o._promise=null,o._noResubscribe=!1,o._setEvents(r),o._initializePromise(),o}return r(t,e),o(t,[{key:"_initializePromise",value:function(){var e=this;this._ready=!1,this._promise=new Promise(function(t,n){e._resolve=function(n){e._ready=!0,t(n)},e._reject=function(t){e._ready=!0,n(t)}})}},{key:"_setEvents",value:function(e){if(e)if((0,c.isFunction)(e))this.on("publication",e);else if(Object.prototype.toString.call(e)===Object.prototype.toString.call({}))for(var t=["publication","join","leave","unsubscribe","subscribe","error"],n=0,s=t.length;n<s;n++){var i=t[n];i in e&&this.on(i,e[i])}}},{key:"_isNew",value:function(){return this._status===h}},{key:"_isUnsubscribed",value:function(){return 4===this._status}},{key:"_isSubscribing",value:function(){return 1===this._status}},{key:"_isReady",value:function(){return 2===this._status||3===this._status}},{key:"_isSuccess",value:function(){return 2===this._status}},{key:"_isError",value:function(){return 3===this._status}},{key:"_setNew",value:function(){this._status=h}},{key:"_setSubscribing",value:function(){!0===this._ready&&(this._initializePromise(),this._isResubscribe=!0),this._status=1}},{key:"_setSubscribeSuccess",value:function(e){if(2!==this._status){this._recovered=e,this._status=2;var t=this._getSubscribeSuccessContext(e);this.emit("subscribe",t),this._resolve(t)}}},{key:"_setSubscribeError",value:function(e){if(3!==this._status){this._status=3,this._error=e;var t=this._getSubscribeErrorContext();this.emit("error",t),this._reject(t)}}},{key:"_triggerUnsubscribe",value:function(){this.emit("unsubscribe",{channel:this.channel})}},{key:"_setUnsubscribed",value:function(e){if(4!==this._status){var t=2===this._status;this._status=4,!0===e&&(this._noResubscribe=!0),t&&this._triggerUnsubscribe()}}},{key:"_shouldResubscribe",value:function(){return!this._noResubscribe}},{key:"_getSubscribeSuccessContext",value:function(){return{channel:this.channel,isResubscribe:this._isResubscribe,recovered:this._recovered}}},{key:"_getSubscribeErrorContext",value:function(){var e=this._error;return e.channel=this.channel,e.isResubscribe=this._isResubscribe,e}},{key:"ready",value:function(e,t){this._ready&&(this._isSuccess()?e(this._getSubscribeSuccessContext()):t(this._getSubscribeErrorContext()))}},{key:"subscribe",value:function(){2!==this._status&&this._centrifuge._subscribe(this)}},{key:"unsubscribe",value:function(){this._setUnsubscribed(!0),this._centrifuge._unsubscribe(this)}},{key:"_methodCall",value:function(e,t){var n=this;return new n._centrifuge._promise(function(s,i){n._promise.then(function(){n._centrifuge._call(e).then(function(e){s(n._centrifuge._decoder.decodeCommandResult(t,e))},function(e){i(e)})},function(e){i(e)})})}},{key:"publish",value:function(e){return this._methodCall({method:this._centrifuge._methodType.PUBLISH,params:{channel:self.channel,data:e}},this._centrifuge._methodType.PUBLISH)}},{key:"presence",value:function(){return this._methodCall({method:this._centrifuge._methodType.PRESENCE,params:{channel:self.channel}},this._centrifuge._methodType.PRESENCE)}},{key:"presenceStats",value:function(){return this._methodCall({method:this._centrifuge._methodType.PRESENCE_STATS,params:{channel:self.channel}},this._centrifuge._methodType.PRESENCE_STATS)}},{key:"history",value:function(){return this._methodCall({method:this._centrifuge._methodType.HISTORY,params:{channel:self.channel}},this._centrifuge._methodType.HISTORY)}}]),t}(a.default);t.default=l,e.exports=t.default},12:function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}();t.JsonMethodType={CONNECT:0,SUBSCRIBE:1,UNSUBSCRIBE:2,PUBLISH:3,PRESENCE:4,PRESENCE_STATS:5,HISTORY:6,PING:7,SEND:8,RPC:9,REFRESH:10},t.JsonPushType={PUBLICATION:0,JOIN:1,LEAVE:2,UNSUB:3,MESSAGE:4},t.JsonEncoder=function(){function e(){s(this,e)}return i(e,[{key:"encodeCommands",value:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(JSON.stringify(e[n]));return t.join("\n")}}]),e}(),t.JsonDecoder=function(){function e(){s(this,e)}return i(e,[{key:"decodeReplies",value:function(e){var t=[],n=e.split("\n");for(var s in n)if(n.hasOwnProperty(s)){if(!n[s])continue;var i=JSON.parse(n[s]);t.push(i)}return t}},{key:"decodeCommandResult",value:function(e,t){return t}},{key:"decodePush",value:function(e){return e}},{key:"decodePushData",value:function(e,t){return t}}]),e}()},3:function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},31:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(10);t.default=s.Centrifuge,e.exports=t.default},6:function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function s(e){return"function"==typeof e}function i(e){return"number"==typeof e}function r(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!i(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,i,u,a,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var h=new Error('Uncaught, unspecified "error" event. ('+t+")");throw h.context=t,h}if(n=this._events[e],o(n))return!1;if(s(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:u=Array.prototype.slice.call(arguments,1),n.apply(this,u)}else if(r(n))for(u=Array.prototype.slice.call(arguments,1),c=n.slice(),i=c.length,a=0;a<i;a++)c[a].apply(this,u);return!0},n.prototype.addListener=function(e,t){var i;if(!s(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,s(t.listener)?t.listener:t),this._events[e]?r(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,r(this._events[e])&&!this._events[e].warned&&(i=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!s(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,i,o,u;if(!s(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,i=-1,n===t||s(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(r(n)){for(u=o;u-- >0;)if(n[u]===t||n[u].listener&&n[u].listener===t){i=u;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],s(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?s(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(s(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},7:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=(t.startsWith=function(e,t){return 0===e.lastIndexOf(t,0)},t.isString=function(e){return void 0!==e&&null!==e&&("string"==typeof e||e instanceof String)},t.isFunction=function(e){return void 0!==e&&null!==e&&"function"==typeof e});t.log=function(t,s){if(e.console){var i=e.console[t];n(i)&&i.apply(e.console,s)}},t.backoff=function(e,t,n){var s=.5*Math.random(),i=t*Math.pow(2,e+1);return i>n&&(i=n),Math.floor((1-s)*i)},t.errorExists=function(e){return"error"in e&&null!==e.error}}).call(t,n(3))}})});
//# sourceMappingURL=centrifuge.min.js.map